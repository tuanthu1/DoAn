<!DOCTYPE html >
<html >
    <head>
        <title>Login ADMIN</title>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="stylesheet" href="/DoAn/dialog.css" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    </head>
    <body>
        <script>
            
        </script>
        <div id="login-box" class="login">
            <p class="login_title">Bạn là admin? Hãy đăng nhập.</p>
            <a href="#" class="close"><img src="/DoAn/img/close.png" class="img-close" title="Close Window" alt="Close" /></a>
            <form method="post" class="login-content" action="#">
            <label class="username">
            <span>Tên hoặc email</span>
            <input id="username" name="username" value="" type="text" autocomplete="on" placeholder="Username">
            </label>
            <label class="password">
            <span>Mật khẩu</span>
            <input id="password" name="password" value="" type="password" placeholder="Password">
            </label>
            <button class="button submit-button" type="button">Đăng nhập</button>
            <p>
            <a class="forgot" href="https://fb.com/tuanthu2911/">Quên mật khẩu?</a>
            </p>     
            <p data-alert id="flash"></p>
            </form>
        </div>
        <script>
            $(document).ready(function() {
                $(document).ready(function() {
                    // Tự động hiển thị hộp đăng nhập khi trang được tải
                    var loginBox = "#login-box";
                    $(loginBox).fadeIn("slow");
    
                    // Thêm phần tử id="over" vào cuối thẻ body
                    $('body').append('<div id="over"></div>');
                    $('#over').fadeIn(1000);
                });
            // Kiểm tra thông tin đăng nhập
            $('.submit-button').on('click', function() {
                var username = $('#username').val();
                var password = $('#password').val();

                $.ajax({
                    url: 'https://67f8cc292466325443edda28.mockapi.io/admin',
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                      var isValid = false;
                      $.each(data, function(index, admin) {
                        if (admin.username === username && admin.password === password) {
                          isValid = true;
                            $('#flash').text('Đăng nhập thành công').css('color', 'red');
                          return false; // dừng lặp
                        }
                      });
                      if (username === '' || password === '') {
                        $('#error').text('Vui lòng nhập đầy đủ thông tin!').css('color', 'red');
                        isValid = false; // nếu username hoặc password rỗng thì không hợp lệ
                      }
                      if (username.length < 3 || password.length < 6) {
                        $('#error').text('Tên đăng nhập phải có ít nhất 3 ký tự và mật khẩu ít nhất 6 ký tự!').css('color', 'red');
                        isValid = false; // nếu username hoặc password không đủ độ dài thì không hợp lệ
                      }
                        // Kiểm tra nếu tài khoản hoặc mật khẩu không có trong localStorage
                        var storedUsers = JSON.parse(localStorage.getItem('adminUsers') || '[]');
                        var foundInLocal = storedUsers.some(function(user) {
                        return user.username === username && user.password === password;
                        });
                        if (!foundInLocal) {
                        $('#error').text('Tài khoản không tồn tại!').css('color', 'red');
                        isValid = false;
                        }
                      
                    },
                    error: function() {
                        $('#flash').text('Không thể kết nối tới máy chủ!').css('color', 'red');
                    }
                  });                  
            });
                // khi click đóng hộp thoại
                $(document).on('click', "a.close, #over", function() { 
                    if ($('#username').val() === '' || $('#password').val() === '') {
                        $('#flash').text('Bạn không phải là admin!, vui lòng nhập thông tin đăng nhập!').css('color', 'red');
                        return false;
                    }
                    $('#over, .login').fadeOut(300 , function() {
                        $('#over').remove();  
                    }); 
                    return false;
                });
                
            });
        </script>
    </body>
</html>
